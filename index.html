<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Channel Subscriber Exchange</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff0000;
            --primary-dark: #cc0000;
            --secondary: #282828;
            --light: #f8f9fa;
            --dark: #212529;
            --warning-bg: #fff3cd;
            --warning-border: #ffeeba;
            --warning-text: #856404;
            --success-bg: #d4edda;
            --success-border: #c3e6cb;
            --success-text: #155724;
            --danger-bg: #f8d7da;
            --danger-border: #f5c6cb;
            --danger-text: #721c24;
            --info-bg: #d1ecf1;
            --info-border: #bee5eb;
            --info-text: #0c5460;
            --notice-blue: #d1e7ff;
            --add-channel-bg: #e0f2ff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f5f5f5;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .add-channel-section {
            background-color: var(--add-channel-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 5px solid;
        }
        
        .alert-warning {
            background-color: var(--warning-bg);
            border-color: var(--warning-border);
            color: var(--warning-text);
        }
        
        .alert-danger {
            background-color: var(--danger-bg);
            border-color: var(--danger-border);
            color: var(--danger-text);
        }
        
        .alert-info {
            background-color: var(--info-bg);
            border-color: var(--info-border);
            color: var(--info-text);
        }
        
        .alert-success {
            background-color: var(--success-bg);
            border-color: var(--success-border);
            color: var(--success-text);
        }
        
        .alert-notice {
            background-color: var(--notice-blue);
            border-color: #b8daff;
            color: #004085;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="url"],
        input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input[type="url"]:focus,
        input[type="password"]:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: var(--success-bg);
            color: var(--success-text);
        }
        
        .badge-warning {
            background-color: var(--warning-bg);
            color: var(--warning-text);
        }
        
        .badge-danger {
            background-color: var(--danger-bg);
            color: var(--danger-text);
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-urdu {
            font-family: 'Nafees', 'Jameel Noori Nastaleeq', 'Urdu Typesetting', sans-serif;
            direction: rtl;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .instructions {
            margin: 25px 0;
        }
        
        .instruction-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .step-number {
            background-color: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            font-weight: bold;
        }
        
        .step-content {
            flex: 1;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px 0;
            color: #666;
            font-size: 14px;
        }
        
        .countdown-green {
            color: #28a745;
            font-weight: bold;
        }
        
        .countdown-yellow {
            color: #ffc107;
            font-weight: bold;
        }
        
        .countdown-red {
            color: #dc3545;
            font-weight: bold;
        }
        
        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        .progress-bar {
            height: 6px;
            background-color: var(--primary);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .password-container {
            display: none;
            margin-top: 15px;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .card {
                padding: 15px;
            }
            
            th, td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fab fa-youtube"></i> YouTube Subscriber Exchange</h1>
            <p class="subtitle">Grow your channel organically with our community</p>
        </div>
    </header>
    
    <div class="container">
        <div class="alert alert-notice">
            <h3><i class="fas fa-exclamation-triangle"></i> Important Notice</h3>
            <p>You can freely add your first YouTube channel link. For 24 hour's.</p>
            <p>For 2nd time UNLIMITED Subscriptions chance, OPEN & Subscribe ALL Links one by one in Channel List.</p>
        </div>
        
        <div class="card">
            <div class="add-channel-section">
                <h2><i class="fas fa-link"></i> Add Your Channel</h2>
                <p>Enter your YouTube channel link below to participate in the subscriber exchange program.</p>
                
                <div class="form-group">
                    <label for="channelLink">YouTube Channel link</label>
                    <input type="url" id="channelLink" placeholder="https://www.youtube.com/@yourchannel" required>
                    <div class="progress-container">
                        <div class="progress-bar" id="userProgress" style="width: 0%"></div>
                    </div>
                    <small id="userLimitMessage">You can add your first channel freely</small>
                </div>
                
                <div id="passwordContainer" class="password-container">
                    <div class="form-group">
                        <label for="addPassword">Enter Password for Additional Entries</label>
                        <input type="password" id="addPassword" placeholder="Enter password">
                    </div>
                </div>
                
                <button class="btn btn-block" id="addButton" onclick="addLink()">
                    <i class="fas fa-plus-circle"></i> Add Channel
                </button>
            </div>
            
            <div class="alert alert-info mt-3">
                <h4><i class="fas fa-info-circle"></i> How to find your channel URL</h4>
                <ol class="instructions">
                    <li class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">Go to <a href="https://youtube.com" target="_blank">youtube.com</a> and sign in</div>
                    </li>
                    <li class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">Click on your profile picture in the top right corner</div>
                    </li>
                    <li class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">Select "Your channel" from the dropdown menu</div>
                    </li>
                    <li class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">Click on "Channel customization"</div>
                    </li>
                    <li class="instruction-step">
                        <div class="step-number">5</div>
                        <div class="step-content">Find and copy your channel URL at the bottom of the page</div>
                    </li>
                </ol>
            </div>
        </div>
        
        <div class="alert alert-danger text-urdu">
            <h3><i class="fas fa-exclamation-circle"></i> تنبیہ</h3>
            <p>اگر آپ نے اپنا لنک انٹر کرکے 24 گھنٹے تک غفلت برتی اور صرف ایک یا چند چینلز سبسکرائب کئے جبکہ باقی 100 چینلز سبسکرائب نہ کئے تو آپ کا <strong>پہلا اور آخری فری چانس</strong> ہمیشہ کے لئے ختم ہوجائے گا، چینل لنک ڈلیٹ کردیا جائے گا، دوسرا فری چانس نہیں ملے گا، سبسکرائبرز نہیں دئے جائیں گے، اور 100 سے کم سبسکرائب کرنے کی صورت میں آپ کو ملے ہوئے سبسکرائبرز بھی <strong>ڈلیٹ</strong> کردئے جائیں گے۔</p></p>
        </div>
        <div class="card">
            <h2><i class="fas fa-list-ol"></i> Channel List</h2>
            <p>Subscribe to all channels below to receive your free organic subscribers.</p>
            
            <div class="table-responsive">
                <table id="linkTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Channel</th>
                            <th>Status</th>
                            <th>Time Remaining</th>
                            <th>Subscribers</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <div id="clearPasswordContainer" class="password-container">
                <div class="form-group">
                    <label for="clearPassword">Enter Password to Clear All Links</label>
                    <input type="password" id="clearPassword" placeholder="Enter password">
                </div>
                <button class="btn btn-outline btn-block" onclick="verifyClearPassword()">
                    <i class="fas fa-key"></i> Verify Password to Clear
                </button>
            </div>
            
            <button class="btn btn-outline btn-block" onclick="showClearPassword()">
                <i class="fas fa-trash-alt"></i> Clear All Links
            </button>
        </div>
        
        <div class="alert alert-success">
            <h3><i class="fas fa-lightbulb"></i> How It Works</h3>
            <ol class="instructions">
                <li class="instruction-step">
                    <div class="step-number">1</div>
                    <div class="step-content">Add your YouTube channel URL above (first one is free)</div>
                </li>
                <li class="instruction-step">
                    <div class="step-number">2</div>
                    <div class="step-content">Open and subscribe to all channels in the list (click each link only once)</div>
                </li>
                <li class="instruction-step">
                    <div class="step-number">3</div>
                    <div class="step-content">Complete all subscriptions within 24 hours</div>
                </li>
                <li class="instruction-step">
                    <div class="step-number">4</div>
                    <div class="step-content">Receive organic subscribers to your channel</div>
                </li>
                <li class="instruction-step">
                    <div class="step-number">5</div>
                    <div class="step-content">After verification, you'll get access to the watch time link</div>
                </li>
            </ol>
            <p class="mt-3"><strong>Remember:</strong> This is a give-and-take system. You must subscribe to others to receive subscribers.</p>
        </div>
    </div>
    
    <footer class="footer">
        <div class="container">
            <p>© 2023 YouTube Subscriber Exchange. This is not affiliated with YouTube or Google LLC.</p>
            <p>All trademarks are the property of their respective owners.</p>
        </div>
    </footer>

    <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCfcHIcSwPKcJfjKDIHLq5aDf-OpKvbUi8",
      authDomain: "muftsub-link.firebaseapp.com",
      databaseURL: "https://muftsub-link-default-rtdb.firebaseio.com",
      projectId: "muftsub-link",
      storageBucket: "muftsub-link.appspot.com",
      messagingSenderId: "528350744421",
      appId: "1:528350744421:web:dfb4fff37d801d25c15b8c"
    };

        // Initialize Firebase with compatibility version
        let db;
        try {
            const app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Error initializing Firebase:", error);
            // Create a mock db object for fallback
            db = {
                collection: () => ({
                    add: () => Promise.reject("Firebase not available"),
                    orderBy: () => ({
                        onSnapshot: () => {}
                    })
                })
            };
        }

        // Constants
        const DAY_MS = 24 * 60 * 60 * 1000;
        const MAX_CLICKS = 100;
        const PASSWORD = "6692";
        const LOCAL_STORAGE_KEY = "youtubeChannelLinks";

        // Load links from both Firestore and local storage
        function loadLinks() {
            loadLinksFromFirestore();
            loadLinksFromLocalStorage();
        }

        // Load links from Firestore
        function loadLinksFromFirestore() {
            const tbody = document.querySelector("#linkTable tbody");
            
            try {
                db.collection("channelLinks").orderBy("addedTime", "desc").onSnapshot(snapshot => {
                    // Clear existing rows
                    const firestoreRows = tbody.querySelectorAll('[data-source="firestore"]');
                    firestoreRows.forEach(row => row.remove());
                    
                    if (snapshot.empty) {
                        if (tbody.children.length === 0) {
                            tbody.innerHTML = `<tr><td colspan="6" class="text-center">No channels added yet</td></tr>`;
                        }
                        return;
                    }
                    
                    let index = 1;
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const remaining = Math.max(0, DAY_MS - (Date.now() - data.addedTime));
                        const h = String(Math.floor(remaining / 3600000)).padStart(2, '0');
                        const m = String(Math.floor((remaining % 3600000) / 60000)).padStart(2, '0');
                        const s = String(Math.floor((remaining % 60000) / 1000)).padStart(2, '0');
                        
                        const tr = document.createElement("tr");
                        tr.setAttribute("data-source", "firestore");
                        tr.setAttribute("data-id", doc.id);
                        tr.innerHTML = `
                            <td>${index++}</td>
                            <td><a href="https://${data.url}" target="_blank">${data.url}</a></td>
                            <td>${data.clicks >= 1 ? '<span class="badge badge-success">Subscribed</span>' : '<span class="badge badge-warning">Pending</span>'}</td>
                            <td>${h}:${m}:${s}</td>
                            <td>${data.clicks}/${MAX_CLICKS}</td>
                            <td><button class="btn btn-sm" onclick="handleChannelClick('${doc.id}','${data.url}',${data.clicks})" ${data.clicks>=1 ? 'disabled' : ''}>${data.clicks>=1 ? 'Done' : 'Open'}</button></td>
                        `;
                        tbody.appendChild(tr);
                    });
                }, error => {
                    console.error("Error loading from Firestore:", error);
                });
            } catch (error) {
                console.error("Error setting up Firestore listener:", error);
            }
        }

        // Load links from local storage
        function loadLinksFromLocalStorage() {
            const tbody = document.querySelector("#linkTable tbody");
            const localLinks = getLocalLinks();
            
            // Clear existing local storage rows
            const localRows = tbody.querySelectorAll('[data-source="local"]');
            localRows.forEach(row => row.remove());
            
            if (localLinks.length === 0) return;
            
            let index = 1;
            localLinks.forEach(link => {
                const remaining = Math.max(0, DAY_MS - (Date.now() - link.addedTime));
                const h = String(Math.floor(remaining / 3600000)).padStart(2, '0');
                const m = String(Math.floor((remaining % 3600000) / 60000)).padStart(2, '0');
                const s = String(Math.floor((remaining % 60000) / 1000)).padStart(2, '0');
                
                const tr = document.createElement("tr");
                tr.setAttribute("data-source", "local");
                tr.setAttribute("data-id", link.id);
                tr.innerHTML = `
                    <td>${index++}</td>
                    <td><a href="https://${link.url}" target="_blank">${link.url}</a></td>
                    <td>${link.clicks >= 1 ? '<span class="badge badge-success">Subscribed</span>' : '<span class="badge badge-warning">Pending</span>'}</td>
                    <td>${h}:${m}:${s}</td>
                    <td>${link.clicks}/${MAX_CLICKS}</td>
                    <td><button class="btn btn-sm" onclick="handleLocalChannelClick('${link.id}','${link.url}',${link.clicks})" ${link.clicks>=1 ? 'disabled' : ''}>${link.clicks>=1 ? 'Done' : 'Open'}</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Get links from local storage
        function getLocalLinks() {
            const linksJson = localStorage.getItem(LOCAL_STORAGE_KEY);
            return linksJson ? JSON.parse(linksJson) : [];
        }

        // Save links to local storage
        function saveLocalLinks(links) {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(links));
        }

        // Add a new channel link
        async function addLink() {
            const inputEl = document.getElementById("channelLink");
            const linkInput = (inputEl.value || "").trim();
            const ytRegex = /^(https?:\/\/)?(www\.)?youtube\.com\/@[a-zA-Z0-9_\-]+\/?$/;
            
            // Show loading state
            const addButton = document.getElementById("addButton");
            const originalText = addButton.innerHTML;
            addButton.innerHTML = '<span class="loading"></span> Adding...';
            addButton.disabled = true;

            if (!linkInput) {
                alert("Please enter a YouTube channel link.");
                addButton.innerHTML = originalText;
                addButton.disabled = false;
                return;
            }

            if (!ytRegex.test(linkInput)) {
                alert("Please enter a valid YouTube channel link like: https://www.youtube.com/@username");
                addButton.innerHTML = originalText;
                addButton.disabled = false;
                return;
            }

            try {
                // Save to Firestore
                const cleanUrl = linkInput.replace(/^https?:\/\//, '');
                await db.collection("channelLinks").add({
                    url: cleanUrl,
                    clicks: 0,
                    addedTime: Date.now()
                });

                // Also save to local storage
                const localLinks = getLocalLinks();
                localLinks.push({
                    id: Date.now().toString(),
                    url: cleanUrl,
                    clicks: 0,
                    addedTime: Date.now()
                });
                saveLocalLinks(localLinks);

                inputEl.value = "";
                
                // Show success message
                const successAlert = document.createElement('div');
                successAlert.className = 'alert alert-success';
                successAlert.innerHTML = '<i class="fas fa-check-circle"></i> Channel added successfully to both Firestore and local storage!';
                document.querySelector('.add-channel-section').appendChild(successAlert);
                
                setTimeout(() => {
                    successAlert.remove();
                }, 5000);
                
                // Refresh the list
                loadLinksFromLocalStorage();
            } catch (error) {
                console.error("Error adding channel to Firestore:", error);
                
                // Fallback: Save only to local storage if Firestore fails
                const cleanUrl = linkInput.replace(/^https?:\/\//, '');
                const localLinks = getLocalLinks();
                localLinks.push({
                    id: Date.now().toString(),
                    url: cleanUrl,
                    clicks: 0,
                    addedTime: Date.now()
                });
                saveLocalLinks(localLinks);
                
                inputEl.value = "";
                
                // Show success message for local storage only
                const successAlert = document.createElement('div');
                successAlert.className = 'alert alert-warning';
                successAlert.innerHTML = '<i class="fas fa-check-circle"></i> Channel added to local storage (Firestore connection failed).';
                document.querySelector('.add-channel-section').appendChild(successAlert);
                
                setTimeout(() => {
                    successAlert.remove();
                }, 5000);
                
                // Refresh the list
                loadLinksFromLocalStorage();
            } finally {
                // Restore button state
                addButton.innerHTML = originalText;
                addButton.disabled = false;
            }
        }

        // Handle click on a Firestore channel
        async function handleChannelClick(docId, url, clicks) {
            if (clicks >= 1) {
                alert("Already clicked this link.");
                return;
            }
            
            try {
                await db.collection("channelLinks").doc(docId).update({
                    clicks: clicks + 1
                });
                window.open("https://" + url, "_blank");
            } catch (error) {
                console.error("Error updating click count:", error);
                alert("Error updating subscription status. Please try again.");
            }
        }

        // Handle click on a local storage channel
        function handleLocalChannelClick(id, url, clicks) {
            if (clicks >= 1) {
                alert("Already clicked this link.");
                return;
            }
            
            const localLinks = getLocalLinks();
            const updatedLinks = localLinks.map(link => {
                if (link.id === id) {
                    return {...link, clicks: clicks + 1};
                }
                return link;
            });
            
            saveLocalLinks(updatedLinks);
            window.open("https://" + url, "_blank");
            
            // Refresh the list
            loadLinksFromLocalStorage();
        }

        // Show password field for clearing links
        function showClearPassword() {
            document.getElementById('clearPasswordContainer').style.display = 'block';
        }

        // Verify password to clear all links
        function verifyClearPassword() {
            const passwordInput = document.getElementById('clearPassword');
            if (passwordInput.value === PASSWORD) {
                clearAllLinks();
                passwordInput.value = '';
                document.getElementById('clearPasswordContainer').style.display = 'none';
                alert('All links have been cleared.');
            } else {
                alert('Incorrect password. Please try again.');
            }
        }

        // Clear all links from both Firestore and local storage
        async function clearAllLinks() {
            // Clear Firestore (this would typically require backend logic)
            try {
                const snapshot = await db.collection("channelLinks").get();
                const batch = db.batch();
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                await batch.commit();
            } catch (error) {
                console.error("Error clearing Firestore data:", error);
            }
            
            // Clear local storage
            localStorage.removeItem(LOCAL_STORAGE_KEY);
            
            // Refresh the list
            loadLinks();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadLinks();
            
            // Set up a timer to update the countdown every second
            setInterval(() => {
                const rows = document.querySelectorAll('#linkTable tbody tr');
                rows.forEach(row => {
                    const source = row.getAttribute('data-source');
                    const id = row.getAttribute('data-id');
                    const timeCell = row.cells[3];
                    
                    if (timeCell) {
                        let addedTime;
                        
                        if (source === 'firestore') {
                            // For Firestore items, we would need to track the addedTime
                            // This is a simplified implementation
                            const links = getLocalLinks();
                            const link = links.find(l => l.id === id);
                            addedTime = link ? link.addedTime : Date.now() - 10000;
                        } else {
                            const links = getLocalLinks();
                            const link = links.find(l => l.id === id);
                            addedTime = link ? link.addedTime : Date.now() - 10000;
                        }
                        
                        const remaining = Math.max(0, DAY_MS - (Date.now() - addedTime));
                        const h = String(Math.floor(remaining / 3600000)).padStart(2, '0');
                        const m = String(Math.floor((remaining % 3600000) / 60000)).padStart(2, '0');
                        const s = String(Math.floor((remaining % 60000) / 1000)).padStart(2, '0');
                        
                        timeCell.textContent = `${h}:${m}:${s}`;
                        
                        // Update status if time is up
                        if (remaining === 0) {
                            const statusCell = row.cells[2];
                            if (statusCell.querySelector('.badge-warning')) {
                                statusCell.innerHTML = '<span class="badge badge-danger">Expired</span>';
                            }
                        }
                    }
                });
            }, 1000);
        });
    </script>
</body>
</html>
